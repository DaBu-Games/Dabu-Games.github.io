<div class="row mb-4">
    <div class="col-12 col-md-6">
        <h1>Gameplay</h1>
        <p>
            Stroke of the blade is a VR game where you can bend elements using a katana.
            This game is a proof of concept and see how I would make the bending mechanic. 
            Right now you can bend four different elements: water, earth, fire and wood.
            You can use these elements to hit enemies or other elements that are being fired at you.
        </p>
    </div>
    <div class="col-12 col-md-6 align-self-center text-center justify-content-center">
        <img src="../media/projects/stroke-of-the-blade/stroke-of-the-blade-bend.gif" alt="game-play-gif" class="w-100 p-3">
    </div>
</div>
<div class="mb-4">
    <h1>Research</h1>
    <div class="row justify-content-center">
        <div class="col-lg-8 col-12">
            <p>
                For this project is researched the Chinese philosophy: Wu-xing translating to five elements.
                The five elements in this philosophy are metal, water, fire, earth and wood.
                Here chose four of the five element to bend in my game.
                The exception was metal because the katana is already made from it.
                <br>
                <br>
                I also use this philosophy to pick the different colors for the elements and their weaknesses.
                Here you can see the different stage of Wu-xing and how they are connected to each other.
            </p>
        </div>
        <div class="col-lg-4 col-md-6 col-8">
                <img src="../media/projects/stroke-of-the-blade/stroke-of-the-blade-wuxing.png" al="wuxing-img" class="w-100 p-3">
        </div>
    </div>
</div>
<div>
    <h1>Slashing</h1>
    <div class="row justify-content-center mb-4">
        <div class="col-lg-7 col-12">
            <p>
               For the slashing I used the state machine I made in
                <a href="bound-to-chainge.html">bound to chainge</a> to make a state machine for the katana.
                Here I made four different states idle, sheathed, sheathing and slashing.
                Now I make transitions between these different states to know in what state the katana is currently in.
                <br>
                <br>
                Now if all the functions are true in the transition from idle to slashing it switches to the slashing state.
                If any of the function are false while in the idle state it transitions to the idle state. 
                The only way to get in to the slashing state is through this transition. 
            </p>
        </div>
        <div class="col-lg-5 col-12">
<pre><code class="language-cs hljs language-csharp">
_sm.AddTransition(new Transition(
    _idle,
    _slashing,
    () => kM.Katana.HasElement() && 
    _slashing.IsMovingForward() && 
    _slashing.IsAboveSpeed()
));
    
_sm.AddTransition(new Transition(
    _slashing,
    _idle,
    () => !kM.Katana.HasElement() || 
        !_slashing.IsAboveSpeed() || 
        !_slashing.IsMovingForward() 
));
            
</code></pre>
        </div>
    </div>
    <div class="row mb-4">
        <div class="col-lg-7 col-12 order-2 order-lg-1">
<pre><code class="language-csharp">
public class Katana : BaseController
{
    public bool HasElement() => Element != null;
}

public class SlashingState : IState
{
    public bool IsAboveSpeed()
    {
        return _kM.Katana.TipVelocity.magnitude >= _minSlashSpeed;
    }
    
    public bool IsMovingForward()
    {
        Vector3 velocityDir = _kM.Katana.TipVelocity.normalized;
        Vector3 bladeForward = -_kM.Katana.transform.up;
    
        float dot = Vector3.Dot(velocityDir, bladeForward);
    
        return dot > _minForwardDot;
    }
}
</code></pre>
        </div>
        <div class="col-lg-5 col-12 order-1 order-lg-2">
            <p>
                The hasElement is a function in the
                <a href="https://github.com/DaBu-Games/StrokeOfTheBlade/blob/Development/StrokeOfTheBlade/Assets/Scripts/Katana/Katana.cs" target="_blank">
                    katana class
                </a>
                that checks if the katana currently has an element.
                <br>
                <br>
                The IsAboveSpeed is a function in the
                <a href="https://github.com/DaBu-Games/StrokeOfTheBlade/blob/Development/StrokeOfTheBlade/Assets/Scripts/StateMachine/States/SlashingState.cs" target="_blank">
                    SlashingState class
                </a>
                that checks if the blade is moving above a certain speed
                <br>
                <br>
                The IsMovingForward is a function in the
                <a href="https://github.com/DaBu-Games/StrokeOfTheBlade/blob/Development/StrokeOfTheBlade/Assets/Scripts/StateMachine/States/SlashingState.cs" target="_blank">
                    SlashingState class
                </a>
                that checks if the blade is moving forward
            </p>
        </div>
    </div>
    <div class="row mb-4">
        <div class="col-lg-6 col-12">
            <pre><code class="language-csharp">
public class StateMachine
{
    public IState currentState { get; private set; }
    private List&lt;Transition&gt; transitions = new List&lt;Transition&gt;();
    private List&lt;Transition&gt; currentTransitions = new List&lt;Transition&gt;();

    public void OnUpdate()
    {
        foreach (var transition in currentTransitions) 
        {
           if( transition.CheckCondition())
               SwitchState( transition.toState );
        }
        
        currentState?.OnUpdate();
    }
}
</code></pre>
        </div>
        <div class="col-lg-6 col-12">
<pre><code class="language-csharp">
public void SwitchState(IState state)
{
    currentState?.OnExitState();
    currentState = state;
    if (currentState == null)
    return;
    
    currentTransitions = transitions.FindAll(
    x => x.fromState == currentState ||
    x.fromState == null);
    
    currentState.OnEnterState();
    Debug.Log(currentState.ToString());
}
</code></pre>
        </div>
    </div>
</div>
<div>
    <h1>Sheathing</h1>
    <div class="row justify-content-center">
        <div class="col-12 mb-4">
            <p>
                To make the blade sheath and unsheathe I made my own animation in unity.
                Here I make the katana a child of the sheath when entering the sheathing state.
                Now i check how far the controller of the sheath and the controller of the katana are from each other.
                <br>
                <br>
                I check this distance with the length of the blade itself this gives me the percentage of how far in the blade should be in the sheath.
                This percentage then gets used to decide how far we are in the animation giving this smooth feeling of sheathing and unsheathing.
                While still giving the player control of the blade.
            </p>
        </div>
    </div>
    <div class="row">
        <div class="col-lg-6 col-12 mb-4">
            <img src="../media/projects/stroke-of-the-blade/sheathing-animation-screenshot.png" alt="sheathing-animation-screenshot" class="w-100">
        </div>
        <div class="col-lg-6 col-12 mb-4">
            <img src="../media/projects/stroke-of-the-blade/sheathing-gif.gif" alt="sheathing-gif" class="w-100">
        </div>
    </div>
    <div class="row mb-4 justify-content-center">
        <div class="col-12 col-lg-10">
<pre><code class="language-csharp">
private void SetSheathAmount()
{
    float distance = Vector3.Distance(_kM.Katana.HandPosition, _kM.Sheath.HandPosition);
    
    distance = Mathf.Clamp(distance, _minDistance, _maxDistance);
    
    _sheathAmount = Mathf.InverseLerp(_maxDistance, _minDistance, distance);
    
    _animation[_sheathClip.name].time = _sheathClip.length * _sheathAmount;
    _animation.Sample(); 
}
</code></pre>
        </div>
    </div>
</div>
<div>
    <h1>Elemental projectile</h1>
    <div class="row justify-content-center mb-4">
        <div class="col-lg-6 col-12">
            <p>
                When a projectile gets spawned it first gets the middle point of all the points the slash is made of.
                Then we use this point to get the direction of the projectile by getting the direction between the players position and this middle point.
                <br>
                <br>
                Before shooting the projectile it also uses this middle point to check if there are any enemies in front of it.
                If there is the projectile curves to this enemy over time.
            </p>
        </div>
        <div class="col-lg-6 col-12">
            <img src="../media/projects/stroke-of-the-blade/projectile-gif.gif" alt="projectile-gif" class="w-100">
        </div>
    </div>
    <div class="row justify-content-center">
        <div class="col-lg-10 col-12">
<pre><code class="language-cs hljs language-csharp">
public void SpawnElement(float speed, List&lt;Vector3> points)
{
        Vector3 start = points[0];
        Vector3 end = points[^1];
        Vector3 middlePoint = GetPhysicalMiddle(points);
        
        Vector3 direction = (middlePoint - _player.position).normalized;
        direction.y = 0f;
        
        List&lt;Vector3&gt; newPoints = new List&lt;Vector3&gt;();
        newPoints.Add(start);
        newPoints.Add(middlePoint);
        newPoints.Add(end);

        Quaternion rotation = Quaternion.LookRotation(direction);

        Transform target = _colliderDetection.GetClosestCollider(middlePoint, direction);
        
        GameObject slash = Instantiate(_elementPrefab, middlePoint, rotation);
        slash.GetComponent&lt;ElementalProjectile()&gt;.Initialize(Element, speed, newPoints, target);
}
</code></pre>
        </div>
    </div>
</div>